<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset='UTF-8' />
        <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes' />
        <meta name='description' content='Digital Asset Vault - Secure management of your BEP20 tokens and BNB on Binance Smart Chain' />
        <meta name='theme-color' content='#000000' />
        <meta name='build-id' content='rollback-v14-2026-02-13' />
        <title>Digital Asset Vault</title>
        <style>
            /* Boot fallback styles - inline to avoid external dependencies */
            #boot-fallback {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(135deg, #0a1628 0%, #1a2332 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                color: #ffffff;
                padding: 20px;
            }
            
            #boot-fallback.hidden {
                display: none;
            }
            
            .boot-container {
                max-width: 500px;
                width: 100%;
                text-align: center;
            }
            
            .boot-icon {
                width: 64px;
                height: 64px;
                margin: 0 auto 24px;
                border-radius: 12px;
                background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 32px;
            }
            
            .boot-spinner {
                width: 48px;
                height: 48px;
                border: 4px solid rgba(14, 165, 233, 0.2);
                border-top-color: #0ea5e9;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 0 auto 24px;
            }
            
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            
            .boot-title {
                font-size: 24px;
                font-weight: 600;
                margin-bottom: 12px;
                color: #ffffff;
            }
            
            .boot-message {
                font-size: 16px;
                line-height: 1.5;
                color: #cccccc;
                margin-bottom: 24px;
            }
            
            .boot-build-id {
                font-size: 13px;
                opacity: 0.8;
                margin-top: 8px;
                display: inline-block;
                color: #99d6ea;
            }
            
            .boot-error-details {
                background: rgba(255, 0, 0, 0.1);
                border: 1px solid rgba(255, 0, 0, 0.3);
                border-radius: 8px;
                padding: 16px;
                margin-bottom: 24px;
                text-align: left;
                font-size: 14px;
                color: #ffcccc;
            }
            
            .boot-button {
                display: inline-block;
                padding: 12px 32px;
                background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
                color: #ffffff;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                text-decoration: none;
                transition: transform 0.2s, box-shadow 0.2s;
                min-height: 44px;
                min-width: 44px;
            }
            
            .boot-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
            }
            
            .boot-button:active {
                transform: translateY(0);
            }
            
            .boot-guidance {
                margin-top: 24px;
                padding: 16px;
                background: rgba(14, 165, 233, 0.1);
                border: 1px solid rgba(14, 165, 233, 0.3);
                border-radius: 8px;
                font-size: 14px;
                line-height: 1.6;
                color: #99d6ea;
            }
            
            .boot-guidance strong {
                color: #0ea5e9;
            }
            
            .boot-technical {
                margin-top: 16px;
                text-align: left;
            }
            
            .boot-technical-toggle {
                background: transparent;
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: #cccccc;
                padding: 8px 16px;
                border-radius: 6px;
                font-size: 13px;
                cursor: pointer;
                transition: all 0.2s;
            }
            
            .boot-technical-toggle:hover {
                border-color: rgba(255, 255, 255, 0.4);
                background: rgba(255, 255, 255, 0.05);
            }
            
            .boot-technical-content {
                display: none;
                margin-top: 12px;
                padding: 12px;
                background: rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 6px;
                font-size: 12px;
                font-family: 'Courier New', monospace;
                color: #aaaaaa;
                text-align: left;
                word-break: break-word;
                max-height: 200px;
                overflow-y: auto;
            }
            
            .boot-technical-content.show {
                display: block;
            }
        </style>
        <script>
            // Boot fallback system with performance measurement
            (function() {
                const BOOT_TIMEOUT = 20000; // 20 seconds
                const STILL_LOADING_THRESHOLD = 3000; // 3 seconds
                const bootFallback = document.getElementById('boot-fallback');
                const bootTitle = document.getElementById('boot-title');
                const bootMessage = document.getElementById('boot-message');
                const bootSpinner = document.getElementById('boot-spinner');
                const bootButton = document.getElementById('boot-button');
                const bootGuidance = document.getElementById('boot-guidance');
                const bootTechnical = document.getElementById('boot-technical');
                const bootTechnicalToggle = document.getElementById('boot-technical-toggle');
                const bootTechnicalContent = document.getElementById('boot-technical-content');

                let appMounted = false;
                let stillLoadingTimer = null;
                let bootTimer = null;
                let scriptLoadFailed = false;
                
                // Get build ID from meta tag
                const buildIdMeta = document.querySelector('meta[name="build-id"]');
                const buildId = buildIdMeta ? buildIdMeta.getAttribute('content') : 'unknown';
                
                // Record navigation start time for performance measurement
                const navigationStartTime = performance.now();

                // Show build ID immediately in loading state
                if (bootMessage) {
                    bootMessage.innerHTML = 'Initializing secure vault interface...<br><span class="boot-build-id">Build: ' + buildId + '</span>';
                }

                // Show "Still loading..." message after threshold
                stillLoadingTimer = setTimeout(() => {
                    if (!appMounted && bootMessage) {
                        bootMessage.innerHTML = 'Still loading... This may take a moment on first visit.<br><span class="boot-build-id">Build: ' + buildId + '</span>';
                    }
                }, STILL_LOADING_THRESHOLD);

                // Show timeout error after full timeout
                bootTimer = setTimeout(() => {
                    if (!appMounted && !scriptLoadFailed) {
                        showBootError(
                            'Loading Timeout',
                            'The app is taking longer than expected to load. This could be due to a slow connection or a script loading issue.',
                            null,
                            'timeout'
                        );
                    }
                }, BOOT_TIMEOUT);

                // Listen for app mounted signal from React
                window.addEventListener('app-mounted', () => {
                    if (!appMounted) {
                        appMounted = true;
                        const appMountedTime = performance.now() - navigationStartTime;
                        
                        // Store performance measurement in window scope for React to read
                        window.__appMountedTime = appMountedTime;
                        
                        clearTimeout(stillLoadingTimer);
                        clearTimeout(bootTimer);
                        setTimeout(() => {
                            if (bootFallback) {
                                bootFallback.classList.add('hidden');
                            }
                        }, 100);
                    }
                });

                // Detect when React mounts content to #root (fallback)
                const rootObserver = new MutationObserver((mutations) => {
                    const root = document.getElementById('root');
                    if (root && root.children.length > 0 && !appMounted) {
                        appMounted = true;
                        const appMountedTime = performance.now() - navigationStartTime;
                        window.__appMountedTime = appMountedTime;
                        
                        clearTimeout(stillLoadingTimer);
                        clearTimeout(bootTimer);
                        setTimeout(() => {
                            if (bootFallback) {
                                bootFallback.classList.add('hidden');
                            }
                        }, 300);
                        rootObserver.disconnect();
                    }
                });

                const root = document.getElementById('root');
                if (root) {
                    rootObserver.observe(root, { childList: true, subtree: true });
                }

                // Network status monitoring
                let isOnline = navigator.onLine;
                window.addEventListener('online', () => { isOnline = true; });
                window.addEventListener('offline', () => { isOnline = false; });

                // Handle script load errors (resource not found)
                window.addEventListener('error', (event) => {
                    if (!appMounted) {
                        // Check if this is a script load error
                        if (event.target && (event.target.tagName === 'SCRIPT' || event.target.tagName === 'LINK')) {
                            scriptLoadFailed = true;
                            clearTimeout(stillLoadingTimer);
                            clearTimeout(bootTimer);
                            
                            const resourceType = event.target.tagName === 'SCRIPT' ? 'JavaScript bundle' : 'stylesheet';
                            const resourceUrl = event.target.src || event.target.href || 'unknown';
                            
                            showBootError(
                                'Resource Not Found',
                                'Failed to load ' + resourceType + '. The application files could not be found. This may be a deployment issue.',
                                { message: 'Failed to load: ' + resourceUrl, stack: 'Resource URL: ' + resourceUrl },
                                'resource-not-found'
                            );
                            return;
                        }
                        
                        // Other runtime errors
                        clearTimeout(stillLoadingTimer);
                        clearTimeout(bootTimer);
                        
                        let sanitizedMessage = 'An error occurred while loading the app.';
                        if (event.message) {
                            if (event.message.includes('Failed to fetch') || event.message.includes('NetworkError')) {
                                sanitizedMessage = 'Network error: Unable to load application resources. Please check your internet connection.';
                            } else if (event.message.includes('404') || event.message.includes('Not Found')) {
                                sanitizedMessage = 'Resource not found: The application files could not be loaded. Please try refreshing.';
                            } else if (event.filename && event.filename.includes('.js')) {
                                sanitizedMessage = 'Script error: Unable to execute application code. Please try refreshing.';
                            } else {
                                sanitizedMessage = 'Script error: ' + event.message.substring(0, 100);
                            }
                        }
                        
                        showBootError('Application Error', sanitizedMessage, event.error, 'runtime-error');
                    }
                });

                window.addEventListener('unhandledrejection', (event) => {
                    if (!appMounted) {
                        clearTimeout(stillLoadingTimer);
                        clearTimeout(bootTimer);
                        
                        let sanitizedMessage = 'An error occurred while loading the app.';
                        if (event.reason?.message) {
                            sanitizedMessage = event.reason.message.substring(0, 150);
                        }
                        
                        showBootError('Loading Failed', sanitizedMessage, event.reason, 'promise-rejection');
                    }
                });

                function showBootError(title, message, error, errorType) {
                    if (!bootFallback) return;

                    // Classify error type for better diagnostics
                    let errorCategory = 'Unknown Error';
                    if (errorType === 'resource-not-found') {
                        errorCategory = '(a) Resource/Script Load Failure';
                    } else if (errorType === 'timeout' || !isOnline) {
                        errorCategory = '(b) Network/Connection Issue';
                    } else if (errorType === 'runtime-error' || errorType === 'promise-rejection') {
                        errorCategory = '(c) Runtime Error';
                    }

                    bootTitle.textContent = title;
                    bootMessage.innerHTML = '<strong>' + errorCategory + '</strong><br>' + 
                        message + 
                        '<br><span class="boot-build-id">Build ID: ' + buildId + '</span>';
                    
                    if (!isOnline) {
                        bootMessage.innerHTML += '<br><br><span style="color: #ff6b6b; font-weight: 600;">‚ö†Ô∏è You appear to be offline</span>';
                    }
                    
                    bootSpinner.style.display = 'none';
                    bootButton.style.display = 'inline-block';
                    bootGuidance.style.display = 'block';
                    bootTechnical.style.display = error ? 'block' : 'none';

                    if (error && bootTechnicalContent) {
                        bootTechnicalContent.textContent = error.stack || error.toString();
                    }

                    bootFallback.classList.remove('hidden');
                }

                if (bootTechnicalToggle && bootTechnicalContent) {
                    bootTechnicalToggle.addEventListener('click', () => {
                        bootTechnicalContent.classList.toggle('show');
                        bootTechnicalToggle.textContent = bootTechnicalContent.classList.contains('show') 
                            ? 'Hide Technical Details' 
                            : 'Show Technical Details';
                    });
                }

                if (bootButton) {
                    bootButton.addEventListener('click', () => {
                        window.location.reload();
                    });
                }
            })();
        </script>
    </head>
    <body>
        <div id='boot-fallback'>
            <div class='boot-container'>
                <div class='boot-icon'>üõ°Ô∏è</div>
                <div id='boot-spinner' class='boot-spinner'></div>
                <h1 id='boot-title' class='boot-title'>Loading Digital Asset Vault</h1>
                <p id='boot-message' class='boot-message'>Initializing secure vault interface...</p>
                <button id='boot-button' class='boot-button' style='display: none;'>
                    Reload Application
                </button>
                <div id='boot-guidance' class='boot-guidance' style='display: none;'>
                    <p><strong>Troubleshooting:</strong></p>
                    <ul style='text-align: left; margin: 8px 0; padding-left: 20px;'>
                        <li>Check your internet connection</li>
                        <li>Clear browser cache and cookies</li>
                        <li>Try a different browser</li>
                        <li>Disable browser extensions temporarily</li>
                        <li>If the issue persists, use "Copy diagnostics" after the app loads</li>
                    </ul>
                </div>
                <div id='boot-technical' class='boot-technical' style='display: none;'>
                    <button id='boot-technical-toggle' class='boot-technical-toggle'>
                        Show Technical Details
                    </button>
                    <div id='boot-technical-content' class='boot-technical-content'></div>
                </div>
            </div>
        </div>
        <div id='root'></div>
        <script type='module' src='/src/main.tsx'></script>
    </body>
</html>
